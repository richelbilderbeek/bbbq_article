---
title: "Chance of a transition"
author: Richel J.C. Bilderbeek
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goal

To determine the chance of mutation that loses or acquires an epitope,
while remaining TMH.

## Setup

We load the libraries needed:

```{r, message=FALSE}
library(testthat)
library(pureseqtmr)
library(bbbq)
```

PureseqTM, which predicts TMHs, must be installed:

```{r}
expect_true(is_pureseqtm_installed())
```

## Abbreviations

Abbr  |Full
------|-----------
AA    |Amino acid
AAs   |Amino acids
Abbr  |Abbreviation
TMH   |Transmembrane helix
TMHs  |Transmembrane helices

## Method

```{r}
mhc_1_haplotype <- "HLA-A26-01"
```

We need to pick a haplotype. I will pick 'HLA-A26-01', because 50 percent
of its epitopes is a TMH. I got that info, 
from `find_tmhs_that_do_not_bind_to_mhc1/find_tmhs_that_do_not_bind_to_mhc1.csv`:

```
"mhc_1_haplotype","percentage of epitopes that are not TMH"
"HLA-A01-01",0.890000000000001
"HLA-A02-01",0
"HLA-A03-01",0.830000000000001
"HLA-A24-02",0.28
"HLA-A26-01",0.51
"HLA-B07-02",0.81
"HLA-B08-01",0.7
"HLA-B18-01",0.74
"HLA-B27-05",0.880000000000001
"HLA-B39-01",0.23
"HLA-B40-02",0.830000000000001
"HLA-B58-01",0.11
"HLA-B15-01",0.08
```

```{r}
n <- 2
ps <- rep(NA, n)
for (i in seq_len(n)) {
  protein_sequence <- bbbq::create_random_tmh(n_aas = 30)
  expect_true(pureseqtmr::is_tmh(protein_sequence))
  p <- calc_p_det_tmh_mut(
    protein_sequence = protein_sequence,
    mhc_1_haplotype = mhc_1_haplotype
  )
  ps[i] <- p
}
ps
```
